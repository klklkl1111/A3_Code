<!DOCTYPE html>
<html>

<head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>list</title>
        <link href="css/public.css" rel="stylesheet" type="text/css">
</head>

<body>
        <div id="dcWrap">
                <div id="dcHead">
                        <div id="head">
                                <div class="logo"><a href="#"
                                                style="line-height: 1.5;color: aliceblue;font-weight: 900;font-size: 24px;">administration</a>
                                </div>
                                <div class="nav">
                                        <ul class="navRight">
                                                <li class="M noLeft"><a href="#">您好，admin</a></li>
                                                <li class="noRight"><a href="#">退出</a></li>
                                        </ul>
                                </div>
                        </div>
                </div>
                <div id="dcLeft">
                        <div id="menu">
                                <ul>
                                        <li class="cur"><a href="fundariser.html"><i class="fundariser"></i><em>fundariser</em></a>
                                        </li>
                                </ul>
                        </div>
                </div>
                <div id="dcMain">
                        <div class="mainBox" style="height:auto!important;height:550px;min-height:550px;">
                                <h3><a href="add.html" class="actionBtn add">add</a>LIST</h3>
                                <div class="filter">
                                        <div style="display: flex;">
                                                <select id="category" style="width: 180px;height: 29px;"></select>
                                                <div class="search-btn" onclick="getList()">serach</div>
                                        </div>
                                </div>
                                <div id="list" style="margin-top: 18px;">
                                        <form name="action" method="post" action="article.php?rec=action">
                                                <table id="fundraiser_list" width="100%" border="1" cellpadding="8" cellspacing="0"></table>
                                        </form>
                                </div>
                        </div>
                </div>
        </div>
        <script>
                (function () {
                        getCategory()
                        getList()
                })()
                function getList() {
                        const list = document.querySelector('#fundraiser_list')
                        let text = `
                                <tr>
                                        <th width="40" align="center">ID</th>
                                        <th align="center">CAPTION</th>
                                        <th align="center">ORGANIZER</th>
                                        <th align="center">TARGET</th>
                                        <th align="center">CURRENT</th>
                                        <th align="center">CITY</th>
                                        <th align="center">STATUS</th>
                                        <th align="center">CATEGORY</th>
                                        <th width="80" align="center">操作</th>
                                </tr>
                        `
                        const category = document.querySelector('#category').value
                        fetch(`http://localhost:8999/api/search?category=${category}&organizer=''`).then(res => {
                                return res.json()
                        }).then(response => {
                                if (response.length) {
                                        response.forEach((element, index) => {
                                                text += `
                                                        <tr>
                                                                <td align="center">`+ (index + 1) + `</td>
                                                                <td align="center"">`+ element.CAPTION + `</td>
                                                                <td align="center"">`+ element.ORGANIZER + `</td>
                                                                <td align="center"">`+ element.TARGET_FUNDING + `</td>
                                                                <td align="center"">`+ element.CURRENT_FUNDING + `</td>
                                                                <td align="center"">`+ element.CITY + `</td>
                                                                <td align="center"">`+ ((element.ACTIVE == 1) ? 'ACTIVE' : 'SUSPENDED') + `</td>
                                                                <td align="center"">`+ element.NAME + `</td>
                                                                <td align="center"">
                                                                        <a href="add.html?id=`+ element.FUNDRAISER_ID + `">UPDATE</a>
                                                                        <a style="color: red;" href="#" onclick="deleteItem(`+ element.FUNDRAISER_ID + `)">DELETE</a>
                                                                </td>
                                                        </tr>
                                                `
                                        });
                                }
                                list.innerHTML = text
                        })
                }
                function getCategory() {
                        const list = document.querySelector('#category')
                        let inner = `<option value="">All</option>`
                        fetch('http://localhost:8999/api/category').then(res => {
                                return res.json()
                        }).then(response => {
                                response.forEach(item => {
                                        inner += `<option value="` + item.CATEGORY_ID + `">` + item.NAME + `</option>`
                                })
                                list.innerHTML = inner
                        })
                }
                function deleteItem(id) {
                        fetch('http://localhost:8999/api/deleteData?id='+id, { method: 'DELETE' }).then(res => {
                                return res.json()
                        }).then(response => {
                                getList()
                                alert('delete success!')
                        })
                }
        </script>
</body>

</html>